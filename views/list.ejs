<!-- htmlê³¼ ë™ì¼ -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/main.css" />
  </head>
  <body class="grey-bg">
    <!-- include í•˜ëŠ” ë°©ë²• -->
    <%- include('nav.ejs') %>
    <!-- //include í•˜ëŠ” ë°©ë²• -->

    <input type="search" class="search" />
    <button class="search-send">ë²„íŠ¼</button>

    <script>
      document.querySelector('.search-send').addEventListener('click', () => {
        let ì…ë ¥í•œê±° = document.querySelector('.search').value;
        location.href = '/search?val=' + ì…ë ¥í•œê±°;
      });
    </script>

    <div class="white-bg">
      <% for (let i=0; i < post.length; i++){ %>
      <div class="list-box" style="cursor: pointer">
        <h4>
          <a href="/detail/<%= post[i]._id %>"><%= post[i].title %></a
          ><a href="/edit/<%= post[i]._id %>">ğŸˆ</a
          ><span class="delete" data-id="<%= post[i]._id %>">ğŸ—‘ï¸</span>
        </h4>
        <p><%= post[i].content %></p>
      </div>
      <%}%>
    </div>

    <img src="/resource/image.png?123" alt="" />

    <script>
      for (let i = 0; i < '<%= post.length %>'; i++) {
        document
          .querySelectorAll('.delete')
          [i].addEventListener('click', function (e) {
            console.log(e.target.dataset.id);
            fetch('/delete?docid=' + e.target.dataset.id, {
              method: 'DELETE',
            })
              .then((r) => {
                if (r.ok) {
                  return r.text(); // ì„±ê³µí•œ ê²½ìš°ì—ë§Œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
                } else {
                  throw new Error('Delete request failed');
                }
              })
              .then((r) => {
                e.target.parentElement.parentElement.style.display = 'none';
              })
              .catch((error) => {
                console.error('Error:', error);
              });
          });
      }
    </script>

    <!-- ejsë¬¸ë²• -->
    <!-- <% %>ìë°”ìŠ¤í¬ë¦½íŠ¸ / <%- %>include(html) / <%= %>ë°ì´í„°ë°”ì¸ë”©(text) -->
  </body>
</html>
